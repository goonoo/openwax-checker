<!DOCTYPE html>
<html>
<head>
  <title>웹접근성 검사기</title>
  <style>
    body { font-family: sans-serif; margin: 0; }
    .container {
      display: flex;
      min-height: 100vh;
      padding-top: 50px; /* 검색창 높이 + 패딩 */
    }
    .sidebar {
      width: 300px;
      background: #2d2d2d;
      padding: 0;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      color: white;
    }
    .main-content {
      margin-left: 300px;
      padding: 20px;
      flex: 1;
      box-sizing: border-box;
    }
    .sticky-header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      padding: 10px 0;
    }
    .result-table { width: 100%; border-collapse: collapse; }
    .result-table th, .result-table td { border: 1px solid #ccc; padding: 8px; }
    /* 모든 테이블의 첫 번째 열 (td 또는 th) */
    .result-table th:first-child,
    .result-table td:first-child {
      width: 50px;
    }

    /* 모든 테이블의 두 번째 열 (td 또는 th) */
    .result-table th:nth-child(2),
    .result-table td:nth-child(2) {
      width: 50px;
    }
    .result-table img { max-width: 80px; max-height: 80px; }
    .fail { background: #ffe5e5; } /* 연한 빨간색 */
    .warning { background: #fffbe5; } /* 연한 노란색 */
    .sidebar-header {
      padding: 8px 7px;
      border-bottom: 1px solid #555;
    }
    .sidebar-header h1 {
      margin: 0;
      font-size: 14px;
      font-weight: 500;
      color: white;
    }
    .sidebar-url {
      font-size: 11px;
      padding: 8px 7px;
      background: #fff;
      color: #666;
      word-break: break-all;
    }
    .nav-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #2d2d2d;
      margin-bottom: 1px;
      border-bottom: 1px solid #444;
      padding: 7px 10px;
      background: #2d2d2d;
      font-size: 13px;
      cursor: pointer;
      color: #ffffff;
      text-decoration: none;
    }
    .nav-item:nth-child(even) {
      background: #2d2d2d;
    }
    .nav-item:hover {
      background: #505050;
    }
    .nav-item.invalid {
      color: white;
      background: rgb(221,30,30);
    }
    .nav-item.invalid:nth-child(even) {
      background: rgb(221,30,30);
    }
    .nav-item.active {
      border-left: 5px solid #007bff;
    }
    .nav-item-text {
      flex: 1;
      text-align: left;
    }
    .nav-item-score {
      text-align: right;
      font-weight: bold;
    }
    .section {
      scroll-margin-top: 80px; /* 검색창 높이 + 여백 */
    }
    .search-container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #fff;
      height: 30px;
      padding: 10px 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      z-index: 1000;
    }
    .search-container form {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      gap: 10px;
    }
    .search-container input {
      flex: 1;
      padding: 6px 12px;
      border: 1px solid #bbb;
      border-radius: 4px;
    }
    .search-container button {
      padding: 6px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .search-container button:hover {
      background: #0056b3;
    }
    .report-button {
      padding: 6px 20px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 10px;
    }
    .report-button:hover {
      background: #218838;
    }
  </style>
</head>
<body>
  <div class="search-container">
    <form class="search" method="GET" action="/analyze">
      <input type="text" name="url" placeholder="분석할 URL을 입력하세요" required value="<%= url %>" />
      <button type="submit">분석</button>
      <% if (typeof url !== 'undefined' && url) { %>
        <button type="button" class="report-button" onclick="generateReport()">보고서 출력</button>
      <% } %>
    </form>
    
    <% if (typeof debugHtml !== 'undefined' && debugHtml) { %>
    <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
      <h3 style="margin: 0 0 10px 0; color: #495057;">🔍 Puppeteer 렌더링된 HTML (Debug 모드)</h3>
      <pre style="background: #fff; padding: 15px; border: 1px solid #ced4da; border-radius: 4px; overflow-x: auto; max-height: 400px; overflow-y: auto; font-size: 12px; line-height: 1.4; white-space: pre-wrap; word-wrap: break-word;"><%= debugHtml %></pre>
    </div>
    <% } %>
  </div>
  <div class="container">
    <% if (typeof url !== 'undefined' && url) { %>
      <div class="sidebar">
        <div class="sidebar-header">
          <h1>target pages</h1>
        </div>
        <div class="sidebar-url">
          <%= url %>
        </div>
        
        <nav>
          <% if (images && images.length > 0) { %>
            <% 
              const validImages = images.filter(img => img.alt !== null);
              const imagePercentage = images.length > 0 ? Math.round((validImages.length / images.length) * 100) : null;
              const hasInvalidImages = validImages.length < images.length;
            %>
            <a href="#section-images" class="nav-item<%= hasInvalidImages ? ' invalid' : '' %>">
              <span class="nav-item-text">5.1.1 적절한 대체 텍스트 제공 (img)</span>
              <span class="nav-item-score"><%= validImages.length %> / <%= images.length %><%= imagePercentage !== null ? ` (${imagePercentage}%)` : '' %></span>
            </a>
          <% } else { %>
            <a href="#section-images" class="nav-item">
              <span class="nav-item-text">5.1.1 적절한 대체 텍스트 제공 (img)</span>
              <span class="nav-item-score">없음</span>
            </a>
          <% } %>
          
          <% if (bgImages && bgImages.length > 0) { %>
            <% 
              const hasInvalidBgImages = bgImages.some(bg => !bg.alt || bg.alt === '');
            %>
            <a href="#section-bg-images" class="nav-item">
              <span class="nav-item-text">5.1.1 적절한 대체 텍스트 제공 (bg)</span>
              <span class="nav-item-score"><%= bgImages.length %></span>
            </a>
          <% } else { %>
            <a href="#section-bg-images" class="nav-item">
              <span class="nav-item-text">5.1.1 적절한 대체 텍스트 제공 (bg)</span>
              <span class="nav-item-score">없음</span>
            </a>
          <% } %>

          <!--
          5.2.1 자막 제공
           * 페이지 내의 video/audio 요소에 자막이 제공되는지 확인
           * 자막 제공 여부에 따라 판단
          -->

          <% if (tables && tables.length > 0) { %>
            <% 
              const validTables = tables.filter(t => t.valid === 'pass');
              const hasInvalidTables = validTables.length < tables.length;
            %>
            <a href="#section-tables" class="nav-item<%= hasInvalidTables ? ' invalid' : '' %>">
              <span class="nav-item-text">5.3.1 표의 구성</span>
              <span class="nav-item-score"><%= validTables.length %> / <%= tables.length %> (<%= tables.length > 0 ? Math.round((validTables.length / tables.length) * 100) : 0 %>%)</span>
            </a>
          <% } else { %>
            <a href="#section-tables" class="nav-item">
              <span class="nav-item-text">5.3.1 표의 구성</span>
              <span class="nav-item-score">없음</span>
            </a>
          <% } %>

          <!--
          5.3.2 콘텐츠의 선형구조
          -->

          <!--
          5.3.3 명확한 지시사항 제공
          -->

          <!--
          5.4.1 색에 무관한 콘텐츠 인식
          -->

          <!--
          5.4.2 자동 재생 금지
          -->

          <!--
          5.4.3 텍스트 콘텐츠의 명도 대비
          -->

          <!--
          5.4.4 콘텐츠 간의 구분
          -->

          <!--
          6.1.1 키보드 사용 보장
          -->

          <% if (focus && focus.length > 0) { %>
            <a href="#section-focus" class="nav-item invalid">
              <span class="nav-item-text">6.1.2 초점 이동과 표시</span>
              <span class="nav-item-score"><%= focus.length %> Error(s)</span>
            </a>
          <% } else { %>
            <a href="#section-focus" class="nav-item">
              <span class="nav-item-text">6.1.2 초점 이동과 표시</span>
              <span class="nav-item-score">없음</span>
            </a>
          <% } %>

          <!--
          6.1.3 조작 가능
          -->

          <!--
          6.1.4 문자 단축키
          -->

          <!--
          6.2.1 응답시간 조절
          -->

          <!--
          6.2.2 정지 기능 제공
          -->

          <!--
          6.3.1 깜빡임과 번쩍임 사용 제한
          -->
          
          <% if (skipNavigations && skipNavigations.length > 0) { %>
            <% 
              const connectedSkipNavs = skipNavigations.filter(skip => skip.connected);
              const skipNavPercentage = skipNavigations.length > 0 ? Math.round((connectedSkipNavs.length / skipNavigations.length) * 100) : null;
              const hasInvalidSkipNavs = connectedSkipNavs.length < skipNavigations.length;
            %>
            <a href="#section-skip-nav" class="nav-item<%= hasInvalidSkipNavs ? ' invalid' : '' %>">
              <span class="nav-item-text">6.4.1 반복 영역 건너뛰기</span>
              <span class="nav-item-score"><%= connectedSkipNavs.length %> / <%= skipNavigations.length %><%= skipNavPercentage !== null ? ` (${skipNavPercentage}%)` : '' %></span>
            </a>
          <% } else { %>
            <a href="#section-skip-nav" class="nav-item">
              <span class="nav-item-text">6.4.1 반복 영역 건너뛰기</span>
              <span class="nav-item-score">없음</span>
            </a>
          <% } %>
          
          <% if (pageTitle && typeof pageTitle.valid !== 'undefined') { %>
            <a href="#section-page-title" class="nav-item<%= pageTitle.valid !== 'pass' ? ' invalid' : '' %>">
              <span class="nav-item-text">6.4.2 제목 제공 - 페이지</span>
              <span class="nav-item-score"><%= pageTitle.valid === 'pass' ? '1' : '0' %> / 1 <%= pageTitle.valid === 'pass' ? '(100%)' : '(0%)' %></span>
            </a>
          <% } else { %>
            <a href="#section-page-title" class="nav-item">
              <span class="nav-item-text">6.4.2 제목 제공 - 페이지</span>
              <span class="nav-item-score">없음</span>
            </a>
          <% } %>
          
          <% if (frames && frames.length > 0) { %>
            <% 
              const validFrames = frames.filter(frame => frame.valid === 'pass');
              const framePercentage = frames.length > 0 ? Math.round((validFrames.length / frames.length) * 100) : null;
              const hasInvalidFrames = validFrames.length < frames.length;
            %>
            <a href="#section-frames" class="nav-item<%= hasInvalidFrames ? ' invalid' : '' %>">
              <span class="nav-item-text">6.4.2 제목 제공 - 프레임</span>
              <span class="nav-item-score"><%= validFrames.length %> / <%= frames.length %><%= framePercentage !== null ? ` (${framePercentage}%)` : '' %></span>
            </a>
          <% } else { %>
            <a href="#section-frames" class="nav-item">
              <span class="nav-item-text">6.4.2 제목 제공 - 프레임</span>
              <span class="nav-item-score">없음</span>
            </a>
          <% } %>
          
          <% if (headings && headings.length > 0) { %>
            <a href="#section-headings" class="nav-item<%= headings.length === 0 ? ' invalid' : '' %>">
              <span class="nav-item-text">6.4.2 제목 제공 - 콘텐츠 블록</span>
              <span class="nav-item-score"><%= headings.length %> (<% if (headings.length > 0) { %>O<% } else { %>X<% } %>)</span>
            </a>
          <% } else { %>
            <a href="#section-headings" class="nav-item">
              <span class="nav-item-text">6.4.2 제목 제공 - 콘텐츠 블록</span>
              <span class="nav-item-score">없음</span>
            </a>
          <% } %>

          <!--
          6.4.3 적절한 링크 텍스트
          -->

          <!--
          6.4.4 고정된 참조 위치 정보
          -->

          <!--
          6.5.1 단일 포인터 입력 지원
          -->

          <!--
          6.5.2 포인터 입력 취소
          -->

          <!--
          6.5.3 레이블과 네임
          -->

          <!--
          6.5.4 동작기반 작동
          -->

          <% if (pageLang && pageLang.length > 0) { %>
            <% 
              const validPageLang = pageLang.filter(lang => lang.valid === 'pass');
              const hasInvalidPageLang = validPageLang.length < pageLang.length;
            %>
            <a href="#section-page-lang" class="nav-item<%= hasInvalidPageLang ? ' invalid' : '' %>">
              <span class="nav-item-text">7.1.1 기본 언어 표시</span>
              <span class="nav-item-score"><%= validPageLang.length %> / <%= pageLang.length %> (<%= Math.round((validPageLang.length / pageLang.length) * 100) %>%)</span>
            </a>
          <% } else { %>
            <a href="#section-page-lang" class="nav-item">
              <span class="nav-item-text">7.1.1 기본 언어 표시</span>
              <span class="nav-item-score">없음</span>
            </a>
          <% } %>

          <% if (userRequest && userRequest.length > 0) { %>
            <% 
              const validUserRequest = userRequest.filter(request => request.valid === 'pass');
              const hasInvalidUserRequest = validUserRequest.length < userRequest.length;
            %>
            <a href="#section-user-request" class="nav-item<%= hasInvalidUserRequest ? ' invalid' : '' %>">
              <span class="nav-item-text">7.2.1 사용자 요구에 따른 실행</span>
              <span class="nav-item-score"><%= validUserRequest.length %> / <%= userRequest.length %> (<%= Math.round((validUserRequest.length / userRequest.length) * 100) %>%)</span>
            </a>
          <% } else { %>
            <a href="#section-user-request" class="nav-item">
              <span class="nav-item-text">7.2.1 사용자 요구에 따른 실행</span>
              <span class="nav-item-score">없음</span>
            </a>
          <% } %>

          <!--
          7.2.2 찾기 쉬운 도움 정보
          -->

          <!--
          7.3.1 오류 정정
          -->

          <% if (inputLabels && inputLabels.length > 0) { %>
            <% 
              const validLabels = inputLabels.filter(label => label.valid === 'pass');
              const labelPercentage = inputLabels.length > 0 ? Math.round((validLabels.length / inputLabels.length) * 100) : null;
              const hasInvalidLabels = validLabels.length < inputLabels.length;
            %>
            <a href="#section-input-labels" class="nav-item<%= hasInvalidLabels ? ' invalid' : '' %>">
              <span class="nav-item-text">7.3.2 레이블 제공</span>
              <span class="nav-item-score"><%= validLabels.length %> / <%= inputLabels.length %><%= labelPercentage !== null ? ` (${labelPercentage}%)` : '' %></span>
            </a>
          <% } else { %>
            <a href="#section-input-labels" class="nav-item">
              <span class="nav-item-text">7.3.2 레이블 제공</span>
              <span class="nav-item-score">없음</span>
            </a>
          <% } %>

          <!--
          7.3.3 접근 가능한 인증
          -->

          <!--
          7.3.4 반복 입력 정보
          -->

          <!--
          8.1.1 마크업 오류 방지
          -->

          <% if (webApplication && webApplication.length > 0) { %>
            <% 
              const validWebApps = webApplication.filter(app => app.valid === 'pass');
              const hasInvalidWebApps = validWebApps.length < webApplication.length;
            %>
            <a href="#section-web-application" class="nav-item<%= hasInvalidWebApps ? ' invalid' : '' %>">
              <span class="nav-item-text">8.2.1 웹 애플리케이션 접근성 준수</span>
              <span class="nav-item-score"><%= validWebApps.length %> / <%= webApplication.length %> (<%= Math.round((validWebApps.length / webApplication.length) * 100) %>%)</span>
            </a>
          <% } else { %>
            <a href="#section-web-application" class="nav-item">
              <span class="nav-item-text">8.2.1 웹 애플리케이션 접근성 준수</span>
              <span class="nav-item-score">없음</span>
            </a>
          <% } %>
        </nav>
      </div>
      <div class="main-content">
        <div id="section-images" class="section">
          <h2>5.1.1 적절한 대체 텍스트 제공 (img)</h2>
          <% if (images && images.length > 0) { %>
            <div style="margin: 0 0 10px 0; font-weight: bold;">총 이미지 수: <%= images.length %></div>
            <table class="result-table">
              <tr>
                <th>result</th>
                <th>hidden</th>
                <th>이미지</th>
                <th>대체 텍스트</th>
              </tr>
              <% images.forEach(img => { %>
                <% let cellClass = ""; let altText = img.alt; %>
                <% if (img.alt === null) { cellClass = 'fail'; altText = 'alt 없음'; } %>
                <% if (img.alt === '') { cellClass = 'warning'; altText = 'alt=""'; } %>
                <tr class="<%= img.valid === 'fail' ? 'fail' : '' %> <%= cellClass %>" style="opacity:<%= img.hidden ? '0.5' : '1' %>;">
                  <td><%= img.valid %></td>
                  <td><%= img.hidden ? 'hidden' : '' %></td>
                  <td><img src="<%= img.src %>" /></td>
                  <td><%= altText %>
                    <% if (img.longdesc) { %>
                      <br>longdesc: <a href="<%= img.longdesc %>" target="_blank"><%= img.longdesc %></a>
                    <% } %>
                  </td>
                </tr>
              <% }) %>
            </table>
          <% } else { %>
            <div style="padding: 20px; text-align: center; color: #666; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
              <p style="margin: 0; font-size: 16px;">검사된 페이지에서 이미지가 발견되지 않았습니다.</p>
            </div>
          <% } %>
        </div>

        <div id="section-bg-images" class="section">
          <h2>5.1.1 적절한 대체 텍스트 제공 (bg)</h2>
          <% if (bgImages && bgImages.length > 0) { %>
            <div style="margin: 0 0 10px 0; font-weight: bold;">총 background-image 요소 수: <%= bgImages.length %></div>
            <table class="result-table">
              <tr>
                <th>result</th>
                <th>hidden</th>
                <th>이미지</th>
                <th>대체 텍스트</th>
              </tr>
              <% bgImages.forEach(bg => { %>
                <tr style="opacity:<%= bg.hidden ? '0.5' : '1' %>;">
                  <td>-</td>
                  <td><%= bg.hidden ? 'hidden' : '' %></td>
                  <td><div style="width:80px; height:80px; background:url('<%= bg.src %>') center/cover no-repeat; border-radius:6px;"></div></td>
                  <td><%= bg.alt %></td>
                </tr>
              <% }) %>
            </table>
          <% } else { %>
            <div style="padding: 20px; text-align: center; color: #666; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
              <p style="margin: 0; font-size: 16px;">검사된 페이지에서 background-image 요소가 발견되지 않았습니다.</p>
            </div>
          <% } %>
        </div>

        <div id="section-tables" class="section">
          <h2>5.3.1 표의 구성</h2>
          <% if (tables && tables.length > 0) { %>
            <table class="result-table">
              <thead>
                <tr>
                  <th>result</th>
                  <th>hidden</th>
                  <th>표 구조</th>
                </tr>
              </thead>
              <tbody>
                <% tables.forEach((table, idx) => { %>
                  <tr class="<%= table.valid === 'fail' ? 'fail' : '' %> <%= table.valid === 'warning' ? 'warning' : '' %>">
                    <td><%= table.valid %></td>
                    <td><%= table.hidden ? 'hidden' : '' %></td>
                    <td>
                      <div>caption: <%= table.caption %></div>
                      <div>summary: <%= table.summary %></div>
                      <table class="result-table">
                        <tr>
                          <th>요소명</th>
                          <th>유무</th>
                          <th>제목셀(scope)</th>
                        </tr>
                        <tbody>
                          <tr>
                            <td>thead</td>
                            <td><%= table.thead ? 'O' : 'X' %></td>
                            <td>
                              <% table.theadCells.forEach(row => { %>
                                <% row.forEach(cell => { %>
                                  <% if(cell.tag === 'th') { %>
                                    <div><%= cell.text %> (<%= cell.scope || 'X' %>)</div>
                                  <% } %>
                                <% }) %>
                              <% }) %>
                            </td>
                          </tr>
                          <tr>
                            <td>tfoot</td>
                            <td><%= table.tfoot ? 'O' : 'X' %></td>
                            <td>
                              <% table.tfootCells.forEach(row => { %>
                                <% row.forEach(cell => { %>
                                  <% if(cell.tag === 'th') { %>
                                    <div><%= cell.text %> (<%= cell.scope || 'X'%>)</div>
                                  <% } %>
                                <% }) %>
                              <% }) %>
                            </td>
                          </tr>
                          <tr>
                            <td>tbody</td>
                            <td><%= table.tbody ? 'O' : 'X' %></td>
                            <td>
                              <% table.tbodyCells.forEach(row => { %>
                                <% row.forEach(cell => { %>
                                  <% if(cell.tag === 'th') { %>
                                    <div><%= cell.text %> (<%= cell.scope || 'X' %>)</div>
                                  <% } %>
                                <% }) %>
                              <% }) %>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          <% } else { %>
            <div style="padding: 20px; text-align: center; color: #666; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
              <p style="margin: 0; font-size: 16px;">검사된 페이지에서 표가 발견되지 않았습니다.</p>
            </div>
          <% } %>
        </div>

        <div id="section-focus" class="section">
          <h2>6.1.2 초점 이동과 표시</h2>
          <% if (focus && focus.length > 0) { %>
            <div style="margin: 0 0 10px 0; font-weight: bold;">총 초점 표시 문제 수: <%= focus.length %></div>
            <table class="result-table">
              <thead>
                <tr>
                  <th>result</th>
                  <th>hidden</th>
                  <th>요소명</th>
                  <th>에러 타입</th>
                  <th>내용</th>
                </tr>
              </thead>
              <tbody>
                <% focus.forEach(item => { %>
                  <tr class="<%= item.valid === 'fail' ? 'fail' : '' %>">
                    <td><%= item.valid %></td>
                    <td><%= item.hidden ? 'hidden' : '' %></td>
                    <td><%= item.tag %></td>
                    <td><%= item.issueType || 'unknown' %></td>
                    <td><%= item.text %></td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          <% } else { %>
            <div style="padding: 20px; text-align: center; color: #666; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
              <p style="margin: 0; font-size: 16px;">검사된 페이지에서 초점 표시 문제가 발견되지 않았습니다.</p>
            </div>
          <% } %>
        </div>

        <div id="section-skip-nav" class="section">
          <h2>6.4.1 반복 영역 건너뛰기</h2>
          <% if (skipNavigations && skipNavigations.length > 0) { %>
            <div style="margin: 0 0 10px 0; font-weight: bold;">총 건너뛰기 링크 수: <%= skipNavigations.length %></div>
            <table class="result-table">
              <tr>
                <th>result</th>
                <th>hidden</th>
                <th>링크 순서</th>
                <th>링크 내용</th>
                <th>연결 여부</th>
              </tr>
              <% skipNavigations.forEach(skipNav => { %>
                <tr class="<%= skipNav.valid === 'fail' ? 'fail' : '' %> <%= skipNav.valid === 'warning' ? 'warning' : '' %>">
                  <td><%= skipNav.valid %></td>
                  <td><%= skipNav.hidden ? 'hidden' : '' %></td>
                  <td><%= skipNav.label %></td>
                  <td><%= skipNav.value %></td>
                  <td><%= skipNav.connected ? 'O' : 'X' %></td>
                </tr>
              <% }) %>
            </table>
          <% } else { %>
            <div style="padding: 20px; text-align: center; color: #666; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
              <p style="margin: 0; font-size: 16px;">검사된 페이지에서 건너뛰기 링크가 발견되지 않았습니다.</p>
            </div>
          <% } %>
        </div>

        <div id="section-page-title" class="section">
          <h2>6.4.2 제목 제공 - 페이지</h2>
          <% if (pageTitle && typeof pageTitle.valid !== 'undefined') { %>
            <table class="result-table">
              <thead>
                <tr>
                  <th>result</th>
                  <th>hidden</th>
                  <th>페이지 제목</th>
                </tr>
              </thead>
              <tbody>
                <tr class="<%= pageTitle.valid === 'fail' ? 'fail' : '' %> <%= pageTitle.valid === 'warning' ? 'warning' : '' %>">
                  <td><%= pageTitle.valid %></td>
                  <td><%= pageTitle.hidden ? 'hidden' : '' %></td>
                  <td><%= pageTitle.title || '제목 없음' %></td>
                </tr>
              </tbody>
            </table>
          <% } else { %>
            <div style="padding: 20px; text-align: center; color: #666; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
              <p style="margin: 0; font-size: 16px;">페이지 제목 정보를 가져올 수 없습니다.</p>
            </div>
          <% } %>
        </div>

        <div id="section-frames" class="section">
          <h2>6.4.2 제목 제공 - 프레임</h2>
          <% if (frames && frames.length > 0) { %>
            <div style="margin: 0 0 10px 0; font-weight: bold;">총 iframe 수: <%= frames.length %></div>
            <table class="result-table">
              <tr>
                <th>result</th>
                <th>hidden</th>
                <th>프레임 제목</th>
                <th>프레임 URL</th>
              </tr>
              <% frames.forEach(frame => { %>
                <tr class="<%= frame.valid === 'fail' ? 'fail' : '' %> <%= frame.valid === 'warning' ? 'warning' : '' %>" style="opacity:<%= frame.hidden ? '0.5' : '1' %>;">
                  <td><%= frame.valid %></td>
                  <td><%= frame.hidden ? 'hidden' : '' %></td>
                  <td><%= frame.value || '제목 없음' %></td>
                  <td style="word-break: break-all;"><%= frame.contents %></td>
                </tr>
              <% }) %>
            </table>
          <% } else { %>
            <div style="padding: 20px; text-align: center; color: #666; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
              <p style="margin: 0; font-size: 16px;">검사된 페이지에서 iframe이 발견되지 않았습니다.</p>
            </div>
          <% } %>
        </div>

        <div id="section-headings" class="section">
          <h2>6.4.2 제목 제공 - 콘텐츠 블록</h2>
          <% if (headings && headings.length > 0) { %>
            <div style="margin: 0 0 10px 0; font-weight: bold;">총 헤딩 수: <%= headings.length %></div>
            <table class="result-table">
              <tr>
                <th>result</th>
                <th>hidden</th>
                <th>요소명</th>
                <th>내용</th>
              </tr>
              <% headings.forEach(heading => { %>
                <tr class="<%= heading.valid === 'fail' ? 'fail' : '' %> <%= heading.valid === 'warning' ? 'warning' : '' %>" style="opacity:<%= heading.hidden ? '0.5' : '1' %>;">
                  <td><%= heading.valid %></td>
                  <td><%= heading.hidden ? 'hidden' : '' %></td>
                  <td><%= heading.value %></td>
                  <td><%= heading.contents %></td>
                </tr>
              <% }) %>
            </table>
          <% } else { %>
            <div style="padding: 20px; text-align: center; color: #666; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
              <p style="margin: 0; font-size: 16px;">검사된 페이지에서 헤딩이 발견되지 않았습니다.</p>
            </div>
          <% } %>
        </div>

        <div id="section-page-lang" class="section">
          <h2>7.1.1 기본 언어 표시</h2>
          <% if (pageLang && pageLang.length > 0) { %>
            <div style="margin: 0 0 10px 0; font-weight: bold;">총 페이지 수: <%= pageLang.length %></div>
            <table class="result-table">
              <thead>
                <tr>
                  <th>result</th>
                  <th>hidden</th>
                  <th>페이지 URL</th>
                  <th>언어 코드</th>
                </tr>
              </thead>
              <tbody>
                <% pageLang.forEach(lang => { %>
                  <tr class="<%= lang.valid === 'fail' ? 'fail' : '' %> <%= lang.valid === 'warning' ? 'warning' : '' %>">
                    <td><%= lang.valid %></td>
                    <td><%= lang.hidden ? 'hidden' : '' %></td>
                    <td><a href="<%= lang.url %>" target="_blank"><%= lang.url %></a></td>
                    <td><%= lang.lang || '언어 설정 없음' %></td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          <% } else { %>
            <div style="padding: 20px; text-align: center; color: #666; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
              <p style="margin: 0; font-size: 16px;">페이지 언어 정보를 가져올 수 없습니다.</p>
            </div>
          <% } %>
        </div>

        <div id="section-user-request" class="section">
          <h2>7.2.1 사용자 요구에 따른 실행 - 새 창 링크</h2>
          <% if (userRequest && userRequest.length > 0) { %>
            <div style="margin: 0 0 10px 0; font-weight: bold;">총 새 창 링크 수: <%= userRequest.length %></div>
            <table class="result-table">
              <thead>
                <tr>
                  <th>result</th>
                  <th>hidden</th>
                  <th>요소명</th>
                  <th>title 속성</th>
                  <th>target 속성</th>
                  <th>텍스트</th>
                </tr>
              </thead>
              <tbody>
                <% userRequest.forEach(request => { %>
                  <tr class="<%= request.valid === 'fail' ? 'fail' : '' %> <%= request.valid === 'warning' ? 'warning' : '' %>">
                    <td><%= request.valid %></td>
                    <td><%= request.hidden ? 'hidden' : '' %></td>
                    <td><%= request.tag %></td>
                    <td><%= request.title %></td>
                    <td><%= request.target %></td>
                    <td><%= request.text %></td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          <% } else { %>
            <div style="padding: 20px; text-align: center; color: #666; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
              <p style="margin: 0; font-size: 16px;">검사된 페이지에서 새 창 링크가 발견되지 않았습니다.</p>
            </div>
          <% } %>
        </div>

        <section id="section-input-labels" class="section">
          <h2>7.3.2 레이블 제공</h2>
          <% if (inputLabels && inputLabels.length > 0) { %>
            <div class="stats">
              <div class="stat-item">
                <span class="stat-label">총 입력 필드 수</span>
                <span class="stat-value"><%= inputLabels.length %></span>
              </div>
            </div>
            <table class="result-table">
              <thead>
                <tr>
                  <th>result</th>
                  <th>hidden</th>
                  <th>요소명</th>
                  <th>타입</th>
                  <th>레이블</th>
                  <th>title 속성</th>
                </tr>
              </thead>
              <tbody>
                <% inputLabels.forEach(label => { %>
                  <tr class="<%= label.valid === 'fail' ? 'fail' : '' %> <%= label.valid === 'warning' ? 'warning' : '' %>" style="opacity:<%= label.hidden ? '0.5' : '1' %>;">
                    <td><%= label.valid %></td>
                    <td><% if (label.hidden) { %>hidden<% } %></td>
                    <td><%= label.tagName %></td>
                    <td><%= label.type %></td>
                    <td>
                      <% if (label.hasLabel) { %><%= label.label %><% } else { %>X<% } %>
                    </td>
                    <td><%= label.title %></span></td>
                  </tr>
                <% }); %>
              </tbody>
            </table>
          <% } else { %>
            <div style="padding: 20px; text-align: center; color: #666; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
              <p style="margin: 0; font-size: 16px;">검사된 페이지에서 입력 필드가 발견되지 않았습니다.</p>
            </div>
          <% } %>
        </section>

        <section id="section-web-application" class="section">
          <h2>8.2.1 웹 애플리케이션 접근성 준수</h2>
          <% if (webApplication && webApplication.length > 0) { %>
            <div class="stats">
              <div class="stat-item">
                <span class="stat-label">총 WAI-ARIA 인터페이스 수</span>
                <span class="stat-value"><%= webApplication.length %></span>
              </div>
            </div>
            <table class="result-table">
              <thead>
                <tr>
                  <th>result</th>
                  <th>hidden</th>
                  <th>인터페이스</th>
                  <th>상태</th>
                  <th>문제점</th>
                  <th>세부 정보</th>
                </tr>
              </thead>
              <tbody>
                <% webApplication.forEach(app => { %>
                  <tr class="<%= app.valid === 'fail' ? 'fail' : '' %> <%= app.valid === 'warning' ? 'warning' : '' %>" style="opacity:<%= app.hidden ? '0.5' : '1' %>;">
                    <td><%= app.valid %></td>
                    <td><%= app.hidden ? 'hidden' : '' %></td>
                    <td><%= app.interface %></td>
                    <td><%= app.valid %></td>
                    <td>
                      <% if (app.issues && app.issues.length > 0) { %>
                        <ul style="margin: 0; padding-left: 20px;">
                          <% app.issues.forEach(issue => { %>
                            <li><%= issue %></li>
                          <% }) %>
                        </ul>
                      <% } else { %>
                        문제 없음
                      <% } %>
                    </td>
                    <td>
                      <% if (app.interface === 'tablist') { %>
                        탭: <%= app.tabs %>, 패널: <%= app.tabpanels %>
                      <% } else if (app.interface === 'menu' || app.interface === 'menubar') { %>
                        메뉴 아이템: <%= app.menuitems %>, 체크박스: <%= app.menuitemcheckboxes %>, 라디오: <%= app.menuitemradios %>
                      <% } else if (app.interface === 'combobox') { %>
                        리스트박스: <%= app.hasListbox ? '있음' : '없음' %>, 옵션: <%= app.options %>
                      <% } else if (app.interface === 'grid' || app.interface === 'table') { %>
                        행: <%= app.rows %>, 셀: <%= app.cells %>, 행헤더: <%= app.rowheaders %>, 열헤더: <%= app.columnheaders %>
                      <% } else if (app.interface === 'tree') { %>
                        트리 아이템: <%= app.treeitems %>, 그룹: <%= app.groups %>
                      <% } else if (app.interface === 'dialog' || app.interface === 'alertdialog') { %>
                        제목: <%= app.hasTitle ? '있음' : '없음' %>
                      <% } else if (app.interface === 'toolbar') { %>
                        버튼: <%= app.buttons %>, 링크: <%= app.links %>, 입력: <%= app.inputs %>
                      <% } %>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          <% } else { %>
            <div style="padding: 20px; text-align: center; color: #666; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
              <p style="margin: 0; font-size: 16px;">검사된 페이지에서 WAI-ARIA 인터페이스가 발견되지 않았습니다.</p>
              <p style="margin: 10px 0 0 0; font-size: 14px;">탭, 메뉴, 콤보박스, 그리드, 트리, 다이얼로그, 툴바 등의 WAI-ARIA 역할이 있는 요소가 없습니다.</p>
            </div>
          <% } %>
        </section>
      </div>
    </div>
  <% } else { %>
    <!-- URL 입력 안내 섹션 -->
    <div class="welcome-section" style="text-align: center; padding: 60px 20px; max-width: 800px; margin: 0 auto;">
      <div class="welcome-icon" style="font-size: 80px; margin-bottom: 30px; color: #007bff;">
        🔍
      </div>
      
      <h1 style="font-size: 32px; color: #333; margin-bottom: 20px; font-weight: 300;">
        웹 접근성 검사기
      </h1>
      
      <p style="font-size: 18px; color: #666; margin-bottom: 40px; line-height: 1.6;">
        웹사이트의 접근성을 검사하고 개선점을 확인하세요.<br>
        KWAG 2.2 기준에 따라 종합적인 접근성 분석 리포트를 제공합니다.
      </p>
      
      <div class="features-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; margin-bottom: 50px;">
        <div class="feature-card" style="background: #f8f9fa; padding: 25px; border-radius: 8px; border-left: 4px solid #007bff;">
          <div style="font-size: 24px; margin-bottom: 15px;">🎯</div>
          <h3 style="margin: 0 0 10px 0; color: #333; font-size: 18px;">종합 분석</h3>
          <p style="margin: 0; color: #666; font-size: 14px; line-height: 1.5;">
            이미지, 제목, 폼, 테이블 등 12개 영역의 접근성을 종합적으로 검사
          </p>
        </div>
        
        <div class="feature-card" style="background: #f8f9fa; padding: 25px; border-radius: 8px; border-left: 4px solid #28a745;">
          <div style="font-size: 24px; margin-bottom: 15px;">📊</div>
          <h3 style="margin: 0 0 10px 0; color: #333; font-size: 18px;">상세 리포트</h3>
          <p style="margin: 0; color: #666; font-size: 14px; line-height: 1.5;">
            문제점과 개선 방안을 포함한 상세한 분석 결과 제공
          </p>
        </div>
        
        <div class="feature-card" style="background: #f8f9fa; padding: 25px; border-radius: 8px; border-left: 4px solid #ffc107;">
          <div style="font-size: 24px; margin-bottom: 15px;">⚡</div>
          <h3 style="margin: 0 0 10px 0; color: #333; font-size: 18px;">실시간 검사</h3>
          <p style="margin: 0; color: #666; font-size: 14px; line-height: 1.5;">
            동적 콘텐츠를 포함한 실시간 웹페이지 접근성 검사
          </p>
        </div>
      </div>
      
      <div class="how-to-use" style="background: #e3f2fd; padding: 30px; border-radius: 8px; margin-bottom: 40px;">
        <h2 style="margin: 0 0 20px 0; color: #1976d2; font-size: 24px; text-align: center;">
          사용 방법
        </h2>
        <div style="display: flex; justify-content: center; align-items: center; gap: 20px; flex-wrap: wrap;">
          <div class="step" style="text-align: center; flex: 1; min-width: 150px;">
            <div style="background: #007bff; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-weight: bold;">1</div>
            <p style="margin: 0; color: #333; font-weight: 500;">URL 입력</p>
            <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">검사할 웹사이트 주소를 입력하세요</p>
          </div>
          <div style="font-size: 24px; color: #007bff;">→</div>
          <div class="step" style="text-align: center; flex: 1; min-width: 150px;">
            <div style="background: #007bff; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-weight: bold;">2</div>
            <p style="margin: 0; color: #333; font-weight: 500;">분석 실행</p>
            <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">자동으로 접근성 검사를 실행합니다</p>
          </div>
          <div style="font-size: 24px; color: #007bff;">→</div>
          <div class="step" style="text-align: center; flex: 1; min-width: 150px;">
            <div style="background: #007bff; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-weight: bold;">3</div>
            <p style="margin: 0; color: #333; font-weight: 500;">결과 확인</p>
            <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">상세한 접근성 분석 리포트를 확인하세요</p>
          </div>
        </div>
      </div>
      
      <div class="example-urls" style="margin-bottom: 30px;">
        <h3 style="margin: 0 0 15px 0; color: #333; font-size: 18px;">예시 URL</h3>
        <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
          <button onclick="setExampleUrl('https://www.daum.net')" style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px; transition: background 0.3s;">다음</button>
          <button onclick="setExampleUrl('https://www.naver.com')" style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px; transition: background 0.3s;">네이버</button>
          <button onclick="setExampleUrl('https://www.google.com')" style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px; transition: background 0.3s;">구글</button>
          <button onclick="setExampleUrl('https://www.github.com')" style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px; transition: background 0.3s;">GitHub</button>
        </div>
      </div>
      
      <div class="start-message" style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 20px; border-radius: 8px; color: #856404;">
        <p style="margin: 0; font-size: 16px; text-align: center;">
          <strong>지금 시작하세요!</strong> 위의 검색창에 웹사이트 URL을 입력하고 접근성 검사를 실행해보세요.
        </p>
      </div>
    </div>
  <% } %>

  <script>
    // 예시 URL 설정 함수
    function setExampleUrl(url) {
      const urlInput = document.querySelector('input[name="url"]');
      if (urlInput) {
        urlInput.value = url;
        // 자동으로 분석 실행
        const form = urlInput.closest('form');
        if (form) {
          form.submit();
        }
      }
    }
    
    // 보고서 출력 함수
    function generateReport() {
      const urlInput = document.querySelector('input[name="url"]');
      if (urlInput && urlInput.value) {
        window.open(`/report?url=${encodeURIComponent(urlInput.value)}`, '_blank');
      }
    }
    
    // 현재 활성화된 섹션에 따라 네비게이션 항목 하이라이트
    const sections = Array.from(document.querySelectorAll('.section'));
    const navItems = document.querySelectorAll('.nav-item');
    
    function getCurrentSection() {
      const scrollPosition = window.scrollY + 100; // 검색창 높이 고려
      
      for (let i = sections.length - 1; i >= 0; i--) {
        const section = sections[i];
        const sectionTop = section.offsetTop;
        const sectionBottom = sectionTop + section.offsetHeight;
        
        if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
          return section.id;
        }
      }
      
      return sections[0].id; // 기본값
    }
    
    function updateActiveNav() {
      const currentSectionId = getCurrentSection();
      navItems.forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('href') === '#' + currentSectionId) {
          item.classList.add('active');
        }
      });
    }

    // 스크롤 시 현재 섹션으로 네비게이션 항목 스크롤
    const sidebar = document.querySelector('.sidebar');
    
    function scrollToActiveNav() {
      const activeNav = document.querySelector('.nav-item.active');
      if (activeNav && sidebar) {
        const sidebarRect = sidebar.getBoundingClientRect();
        const activeNavRect = activeNav.getBoundingClientRect();
        
        if (activeNavRect.top < sidebarRect.top || activeNavRect.bottom > sidebarRect.bottom) {
          sidebar.scrollTo({
            top: activeNav.offsetTop - sidebar.offsetTop - 20,
            behavior: 'smooth'
          });
        }
      }
    }

    // 스크롤 이벤트에 디바운스 적용
    let scrollTimeout;
    window.addEventListener('scroll', () => {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        updateActiveNav();
        scrollToActiveNav();
      }, 100);
    });

    // 초기 활성화
    updateActiveNav();

    // fragment 링크 클릭 시 부드러운 스크롤
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = item.getAttribute('href')?.substring(1);
        const targetElement = document.getElementById(targetId);
        if (targetElement) {
          targetElement.scrollIntoView({ behavior: 'smooth' });
        }
      });
    });
  </script>
</body>
</html> 